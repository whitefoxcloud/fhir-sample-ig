<nav class="navbar navbar-dark d-flex flex-column justify-content-start align-items-baseline nav-menu-container" style="width: 100%; min-width: 228px; background-color: #121C2D; padding: 32px; font-family: inter; font-weight: 500; font-size: 14px;">
   <style>
    .menu-item-selected {
      background-color: #2A3C5E !important;
      border-radius: 4px !important;
    }
  </style>
  <ul class="nav flex-column w-100">
      <li class="nav-item">
      <a class="nav-link text-white text-decoration-none" style="font-family: inter; font-weight: 500; font-size: 14px; transition: all 0.2s ease;" onmouseover="if(!this.classList.contains('menu-item-selected')) { this.style.backgroundColor='#2A3C5E'; this.style.borderRadius='4px'; }" onmouseout="if(!this.classList.contains('menu-item-selected')) { this.style.backgroundColor='transparent'; this.style.borderRadius='0'; }" href="index.html">IG Home</a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-white text-decoration-none" style="font-family: inter; font-weight: 500; font-size: 14px; transition: all 0.2s ease;" onmouseover="if(!this.classList.contains('menu-item-selected')) { this.style.backgroundColor='#2A3C5E'; this.style.borderRadius='4px'; }" onmouseout="if(!this.classList.contains('menu-item-selected')) { this.style.backgroundColor='transparent'; this.style.borderRadius='0'; }" href="toc.html">Table of Contents</a>
    </li>

    <li class="nav-item">
      <a class="nav-link text-white text-decoration-none" data-bs-toggle="collapse" href="#myIgSubmenu" role="button" style="font-family: inter; font-weight: 500; font-size: 14px; transition: all 0.2s ease; display: flex; gap: 9px; align-items: center;" onmouseover="if(!this.classList.contains('menu-item-selected')) { this.style.backgroundColor='#2A3C5E'; this.style.borderRadius='4px'; }" onmouseout="if(!this.classList.contains('menu-item-selected')) { this.style.backgroundColor='transparent'; this.style.borderRadius='0'; }">
        <svg id="myIgChevron" width="6" height="10" viewBox="0 0 6 10" fill="none" xmlns="http://www.w3.org/2000/svg" style="transition: transform 0.2s ease;">
          <path d="M1 9L5 5L1 1" stroke="#A0AEC7" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>MyIg Background</span>
      </a>
      <div class="collapse" id="myIgSubmenu">
        <ul class="nav flex-column ps-3 py-2">
          <li class="nav-item">
            <a class="nav-link text-white text-decoration-none" href="background.html" style="font-family: inter; font-weight: 500; font-size: 14px; transition: all 0.2s ease;" onmouseover="if(!this.classList.contains('menu-item-selected')) { this.style.backgroundColor='#2A3C5E'; this.style.borderRadius='4px'; }" onmouseout="if(!this.classList.contains('menu-item-selected')) { this.style.backgroundColor='transparent'; this.style.borderRadius='0'; }">Background</a>
          </li>
        </ul>
      </div>
    </li>

    <li class="nav-item">
      <a class="nav-link text-white text-decoration-none" data-bs-toggle="collapse" href="#specSubmenu" role="button" style="font-family: inter; font-weight: 500; font-size: 14px; transition: all 0.2s ease; display: flex; gap: 9px; align-items: center;" onmouseover="if(!this.classList.contains('menu-item-selected')) { this.style.backgroundColor='#2A3C5E'; this.style.borderRadius='4px'; }" onmouseout="if(!this.classList.contains('menu-item-selected')) { this.style.backgroundColor='transparent'; this.style.borderRadius='0'; }">
        <svg id="specChevron" width="6" height="10" viewBox="0 0 6 10" fill="none" xmlns="http://www.w3.org/2000/svg" style="transition: transform 0.2s ease;">
          <path d="M1 9L5 5L1 1" stroke="#A0AEC7" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Specification</span>
      </a>
      <div class="collapse" id="specSubmenu">
        <ul class="nav flex-column ps-3 py-2">
          <li class="nav-item"><a class="nav-link text-white text-decoration-none" href="spec.html" style="font-family: inter; font-weight: 500; font-size: 14px; transition: all 0.2s ease;" onmouseover="if(!this.classList.contains('menu-item-selected')) { this.style.backgroundColor='#2A3C5E'; this.style.borderRadius='4px'; }" onmouseout="if(!this.classList.contains('menu-item-selected')) { this.style.backgroundColor='transparent'; this.style.borderRadius='0'; }">Detailed Specification</a></li>
          <li class="nav-item"><a class="nav-link text-white text-decoration-none" href="fragments.html" style="font-family: inter; font-weight: 500; font-size: 14px; transition: all 0.2s ease;" onmouseover="if(!this.classList.contains('menu-item-selected')) { this.style.backgroundColor='#2A3C5E'; this.style.borderRadius='4px'; }" onmouseout="if(!this.classList.contains('menu-item-selected')) { this.style.backgroundColor='transparent'; this.style.borderRadius='0'; }">Instance Fragments</a></li>
        </ul>
      </div>
    </li>

    <li class="nav-item">
      <a class="nav-link text-white text-decoration-none" href="artifacts.html" style="font-family: inter; font-weight: 500; font-size: 14px; transition: all 0.2s ease;" onmouseover="if(!this.classList.contains('menu-item-selected')) { this.style.backgroundColor='#2A3C5E'; this.style.borderRadius='4px'; }" onmouseout="if(!this.classList.contains('menu-item-selected')) { this.style.backgroundColor='transparent'; this.style.borderRadius='0'; }">Artifact Index</a>
    </li>

    <li class="nav-item">
      <a class="nav-link text-white text-decoration-none" data-bs-toggle="collapse" href="#supportSubmenu" role="button" style="font-family: inter; font-weight: 500; font-size: 14px; transition: all 0.2s ease; display: flex; gap: 9px; align-items: center;" onmouseover="if(!this.classList.contains('menu-item-selected')) { this.style.backgroundColor='#2A3C5E'; this.style.borderRadius='4px'; }" onmouseout="if(!this.classList.contains('menu-item-selected')) { this.style.backgroundColor='transparent'; this.style.borderRadius='0'; }">
        <svg id="supportChevron" width="6" height="10" viewBox="0 0 6 10" fill="none" xmlns="http://www.w3.org/2000/svg" style="transition: transform 0.2s ease;">
          <path d="M1 9L5 5L1 1" stroke="#A0AEC7" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Support</span>
      </a>
      <div class="collapse" id="supportSubmenu">
        <ul class="nav flex-column ps-3 py-2">
          <li class="nav-item">
            <a class="nav-link text-white text-decoration-none" target="_blank" href="{{site.data.fhir.path}}index.html" style="font-family: inter; font-weight: 500; font-size: 14px; transition: all 0.2s ease;" onmouseover="if(!this.classList.contains('menu-item-selected')) { this.style.backgroundColor='#2A3C5E'; this.style.borderRadius='4px'; }" onmouseout="if(!this.classList.contains('menu-item-selected')) { this.style.backgroundColor='transparent'; this.style.borderRadius='0'; }">
              FHIR Spec <img src="external.png" class="ms-1" style="vertical-align: baseline"/>
            </a>
          </li>
          <li class="nav-item"><a class="nav-link text-white text-decoration-none" href="downloads.html" style="font-family: inter; font-weight: 500; font-size: 14px; transition: all 0.2s ease;" onmouseover="if(!this.classList.contains('menu-item-selected')) { this.style.backgroundColor='#2A3C5E'; this.style.borderRadius='4px'; }" onmouseout="if(!this.classList.contains('menu-item-selected')) { this.style.backgroundColor='transparent'; this.style.borderRadius='0'; }">Downloads</a></li>
        </ul>
      </div>
    </li>
  </ul>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const myIgChevron = document.getElementById('myIgChevron');
    const specChevron = document.getElementById('specChevron');
    const supportChevron = document.getElementById('supportChevron');
    
    const myIgTrigger = document.querySelector('[href="#myIgSubmenu"]');
    const specTrigger = document.querySelector('[href="#specSubmenu"]');
    const supportTrigger = document.querySelector('[href="#supportSubmenu"]');
    
    const myIgSubmenu = document.getElementById('myIgSubmenu');
    const specSubmenu = document.getElementById('specSubmenu');
    const supportSubmenu = document.getElementById('supportSubmenu');
    
    let myIgRotated = localStorage.getItem('myIgRotated') === 'true' || myIgSubmenu.classList.contains('show');
    let specRotated = localStorage.getItem('specRotated') === 'true' || specSubmenu.classList.contains('show');
    let supportRotated = localStorage.getItem('supportRotated') === 'true' || supportSubmenu.classList.contains('show');
    
    myIgChevron.style.transform = myIgRotated ? 'rotate(90deg)' : 'rotate(0deg)';
    specChevron.style.transform = specRotated ? 'rotate(90deg)' : 'rotate(0deg)';
    supportChevron.style.transform = supportRotated ? 'rotate(90deg)' : 'rotate(0deg)';
    
    if (myIgRotated) {
      myIgSubmenu.classList.add('show');
    } else {
      myIgSubmenu.classList.remove('show');
    }
    
    if (specRotated) {
      specSubmenu.classList.add('show');
    } else {
      specSubmenu.classList.remove('show');
    }
    
    if (supportRotated) {
      supportSubmenu.classList.add('show');
    } else {
      supportSubmenu.classList.remove('show');
    }
    
    myIgTrigger.addEventListener('mousedown', function(e) {
      myIgRotated = !myIgRotated;
      myIgChevron.style.transform = myIgRotated ? 'rotate(90deg)' : 'rotate(0deg)';
      localStorage.setItem('myIgRotated', myIgRotated);
    });
    
    specTrigger.addEventListener('mousedown', function(e) {
      specRotated = !specRotated;
      specChevron.style.transform = specRotated ? 'rotate(90deg)' : 'rotate(0deg)';
      localStorage.setItem('specRotated', specRotated);
    });
    
    supportTrigger.addEventListener('mousedown', function(e) {
      supportRotated = !supportRotated;
      supportChevron.style.transform = supportRotated ? 'rotate(90deg)' : 'rotate(0deg)';
      localStorage.setItem('supportRotated', supportRotated);
    });
    
    const currentPath = window.location.pathname;
    const filename = currentPath.substring(currentPath.lastIndexOf('/') + 1);
    
    function applySelectedStyling(selectedHref) {
      // Clear any previous selection
      document.querySelectorAll('.nav-link').forEach(link => {
        link.style.backgroundColor = 'transparent';
        link.style.borderRadius = '0';
      });
      
      document.querySelectorAll('.nav-link').forEach(link => {
        const href = link.getAttribute('href');
        if (href === selectedHref) {
          link.style.backgroundColor = '#2A3C5E';
          link.style.borderRadius = '4px';
          
          const parentSubmenu = link.closest('.collapse');
          if (parentSubmenu) {
            parentSubmenu.classList.add('show');
            
            if (parentSubmenu.id === 'myIgSubmenu') {
              myIgChevron.style.transform = 'rotate(90deg)';
              localStorage.setItem('myIgRotated', 'true');
            } else if (parentSubmenu.id === 'specSubmenu') {
              specChevron.style.transform = 'rotate(90deg)';
              localStorage.setItem('specRotated', 'true');
            } else if (parentSubmenu.id === 'supportSubmenu') {
              supportChevron.style.transform = 'rotate(90deg)';
              localStorage.setItem('supportRotated', 'true');
            }
          }
          
          localStorage.setItem('selectedMenuItem', href);
        }
      });
    }
    
    document.querySelectorAll('.nav-link').forEach(link => {
      if (!link.hasAttribute('data-bs-toggle')) {
        link.addEventListener('click', function() {
          const href = this.getAttribute('href');
          if (href && !href.startsWith('http') && !href.startsWith('#')) {
            applySelectedStyling(href);
          }
        });
      }
    });
    
    const savedMenuItem = localStorage.getItem('selectedMenuItem');
    
    if (filename) {
      applySelectedStyling(filename);
    } 
    else if (filename === '' || filename === 'index.html') {
      applySelectedStyling('index.html');
    }
    else if (savedMenuItem) {
      applySelectedStyling(savedMenuItem);
    }
    
    if (!localStorage.getItem('selectedMenuItem') && filename) {
      document.querySelectorAll('.nav-link').forEach(link => {
        const href = link.getAttribute('href');
        if (href === filename) {
          applySelectedStyling(href);
        }
      });
    }


       function applySelectedStyling(selectedHref) {
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('menu-item-selected');
        link.style.backgroundColor = 'transparent';
        link.style.borderRadius = '0';
      });
      
      document.querySelectorAll('.nav-link').forEach(link => {
        const href = link.getAttribute('href');
        if (href === selectedHref) {
          link.classList.add('menu-item-selected');
          link.style.backgroundColor = '#2A3C5E';
          link.style.borderRadius = '4px';
          
          const parentSubmenu = link.closest('.collapse');
          if (parentSubmenu) {
            parentSubmenu.classList.add('show');
            
            if (parentSubmenu.id === 'myIgSubmenu') {
              myIgChevron.style.transform = 'rotate(90deg)';
              localStorage.setItem('myIgRotated', 'true');
            } else if (parentSubmenu.id === 'specSubmenu') {
              specChevron.style.transform = 'rotate(90deg)';
              localStorage.setItem('specRotated', 'true');
            } else if (parentSubmenu.id === 'supportSubmenu') {
              supportChevron.style.transform = 'rotate(90deg)';
              localStorage.setItem('supportRotated', 'true');
            }
          }
          
          localStorage.setItem('selectedMenuItem', href);
        }
      });
    }
  });
</script>
</nav>